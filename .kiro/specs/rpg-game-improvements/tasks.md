# План реализации: Улучшения RPG игры

## Обзор

Данный план описывает пошаговую реализацию улучшений для браузерной RPG игры на React. Реализация разбита на логические блоки с инкрементальной интеграцией функционала.

## Задачи

- [x] 1. Подготовка инфраструктуры и расширение модели данных
  - Расширить интерфейс Player новыми полями (profession, resources, guildId, achievements)
  - Создать константы для новых данных (PROFESSIONS, RECIPES, RESOURCES, NEW_LOCATIONS, NEW_ENEMIES)
  - Обновить функцию saveGame для поддержки новых полей
  - Обновить функцию loadGame с миграцией старых сохранений
  - _Requirements: 10.1, 10.2_

- [x] 2. Реализация системы ресурсов
  - [x] 2.1 Создать базу данных ресурсов (RESOURCES)
    - Определить минимум 10 типов ресурсов с привязкой к локациям
    - Добавить поля: id, name, icon, rarity, locations
    - _Requirements: 3.4_

  - [x] 2.2 Интегрировать сбор ресурсов в функцию handleStep
    - Добавить логику нахождения ресурсов с вероятностью 35%
    - Фильтровать ресурсы по текущей локации
    - Учитывать редкость ресурса при генерации
    - Вызывать addResourceToInventory при находке
    - _Requirements: 3.1, 3.2_

  - [ ]* 2.3 Написать property-тест для соответствия ресурсов локации
    - **Property 10: Ресурсы соответствуют локации**
    - **Validates: Requirements 3.2**

  - [x] 2.4 Создать функции управления ресурсами
    - Реализовать addResourceToInventory(resourceId, amount)
    - Реализовать removeResourceFromInventory(resourceId, amount)
    - Реализовать getResourceCount(resourceId)
    - Реализовать hasResources(requirements)
    - _Requirements: 3.1, 3.6_

  - [x] 2.5 Обновить компонент инвентаря для отображения ресурсов
    - Добавить отдельную секцию "Ресурсы"
    - Группировать одинаковые ресурсы с отображением количества
    - Применить цветовое кодирование редкости
    - _Requirements: 3.5, 3.6_

  - [ ]* 2.6 Написать property-тест для группировки ресурсов
    - **Property 12: Группировка одинаковых ресурсов**
    - **Validates: Requirements 3.6**

- [ ] 3. Checkpoint - Проверка системы ресурсов
  - Убедитесь, что ресурсы находятся во время путешествий, корректно отображаются и группируются. Спросите пользователя, если возникнут вопросы.


- [x] 4. Реализация системы профессий
  - [x] 4.1 Создать базу данных профессий (PROFESSIONS)
    - Определить 4 профессии: Кузнец, Алхимик, Травник, Шахтер
    - Добавить поля: id, name, description, icon, color, baseExp, expGrowth, unlockLevel
    - _Requirements: 1.1_

  - [x] 4.2 Создать компонент ProfessionScreen
    - Отображать список доступных профессий (если не выбрана)
    - Показывать текущую профессию с прогресс-баром уровня
    - Добавить кнопку выполнения действия профессии
    - Отображать список разблокированных рецептов
    - _Requirements: 1.1, 1.5_

  - [x] 4.3 Реализовать функцию selectProfession
    - Назначить профессию игроку
    - Установить professionLevel = 1, professionExp = 0
    - Рассчитать professionMaxExp на основе baseExp
    - _Requirements: 1.2_

  - [ ]* 4.4 Написать property-тест для назначения профессии
    - **Property 1: Назначение профессии устанавливает начальное состояние**
    - **Validates: Requirements 1.2**

  - [x] 4.5 Реализовать функцию performProfessionAction
    - Проверить наличие энергии (стоимость 5 энергии)
    - Добавить опыт профессии (15-30 в зависимости от профессии)
    - Добавить небольшую награду (золото или ресурс)
    - Обновить статистику
    - _Requirements: 1.3_

  - [ ]* 4.6 Написать property-тест для действий профессии
    - **Property 2: Действия профессии увеличивают опыт**
    - **Validates: Requirements 1.3**

  - [x] 4.7 Реализовать повышение уровня профессии
    - Проверять достижение professionMaxExp
    - Увеличивать professionLevel
    - Сбрасывать professionExp
    - Увеличивать professionMaxExp по формуле роста
    - Разблокировать новые рецепты
    - _Requirements: 1.4, 1.6_

  - [ ]* 4.8 Написать property-тест для повышения уровня профессии
    - **Property 3: Повышение уровня профессии сбрасывает опыт**
    - **Validates: Requirements 1.4**

  - [ ]* 4.9 Написать property-тест для разблокировки рецептов
    - **Property 4: Повышение уровня разблокирует рецепты**
    - **Validates: Requirements 1.6**

  - [x] 4.10 Интегрировать ProfessionScreen в навигацию
    - Обновить NavItem для раздела "Профессия"
    - Убрать badge "Бета-версия"
    - Добавить обработчик переключения на activeTab='profession'
    - _Requirements: 1.1_

- [x] 5. Реализация системы крафта
  - [x] 5.1 Создать базу данных рецептов (RECIPES)
    - Определить минимум 15 рецептов для всех профессий
    - Добавить поля: id, name, profession, requiredLevel, ingredients, result, craftTime, expReward
    - Включить рецепты для оружия, брони, зелий, материалов
    - _Requirements: 2.7_

  - [x] 5.2 Создать компонент CraftScreen
    - Отображать список доступных рецептов с фильтрацией
    - Показывать детали рецепта с требуемыми ресурсами
    - Добавить индикатор наличия ресурсов (зеленый/красный)
    - Отображать прогресс-бар крафта (если в процессе)
    - _Requirements: 2.1, 2.2_

  - [x] 5.3 Реализовать функцию getAvailableRecipes
    - Фильтровать рецепты по профессии игрока
    - Фильтровать по уровню навыка профессии
    - Возвращать отсортированный список
    - _Requirements: 2.1_

  - [ ]* 5.4 Написать property-тест для фильтрации рецептов
    - **Property 5: Фильтрация рецептов по профессии и уровню**
    - **Validates: Requirements 2.1**

  - [x] 5.5 Реализовать функцию canCraft
    - Проверять наличие всех требуемых ресурсов
    - Возвращать true/false
    - _Requirements: 2.3_

  - [ ]* 5.6 Написать property-тест для валидации ресурсов
    - **Property 6: Валидация ресурсов перед крафтом**
    - **Validates: Requirements 2.3**

  - [x] 5.7 Реализовать функцию startCrafting
    - Проверять canCraft
    - Если недостаточно ресурсов, показать ошибку и вернуть false
    - Установить состояние крафта с таймером
    - Запустить setTimeout на craftTime
    - _Requirements: 2.3, 2.4_

  - [ ]* 5.8 Написать property-тест для отклонения крафта
    - **Property 7: Отклонение крафта при недостатке ресурсов**
    - **Validates: Requirements 2.4**

  - [x] 5.9 Реализовать функцию completeCraft
    - Удалить использованные ресурсы из инвентаря
    - Добавить созданный предмет в инвентарь
    - Добавить опыт профессии
    - Увеличить счетчик totalCrafts
    - Проверить достижения
    - Показать уведомление об успехе
    - _Requirements: 2.5, 2.6_

  - [ ]* 5.10 Написать property-тест для транзакции крафта
    - **Property 8: Транзакция крафта изменяет инвентарь**
    - **Validates: Requirements 2.5**

  - [ ]* 5.11 Написать property-тест для опыта крафта
    - **Property 9: Крафт добавляет опыт профессии**
    - **Validates: Requirements 2.6**

  - [x] 5.12 Интегрировать CraftScreen в навигацию
    - Обновить NavItem для раздела "Крафт"
    - Добавить обработчик переключения на activeTab='craft'
    - _Requirements: 2.1_

- [ ] 6. Checkpoint - Проверка систем профессий и крафта
  - Убедитесь, что профессии выбираются, действия выполняются, рецепты фильтруются и крафт работает корректно. Спросите пользователя, если возникнут вопросы.


- [x] 7. Реализация системы гильдий
  - [x] 7.1 Создать структуру данных гильдий
    - Определить интерфейс Guild
    - Создать массив GUILDS для хранения гильдий (в реальном приложении это будет backend)
    - Для демонстрации создать 3-5 предзаполненных гильдий
    - _Requirements: 4.3_

  - [x] 7.2 Создать компонент GuildScreen
    - Отображать список доступных гильдий (если не в гильдии)
    - Показывать информацию о текущей гильдии
    - Отображать список членов гильдии
    - Показывать бонусы гильдии
    - Отображать прогресс уровня гильдии
    - _Requirements: 4.3, 4.5, 4.8_

  - [x] 7.3 Реализовать функцию createGuild
    - Проверять наличие 1000 золота
    - Проверять уникальность названия
    - Создать новую гильдию с игроком как лидером
    - Списать 1000 золота
    - Установить guildId и guildRole игроку
    - _Requirements: 4.1, 4.2_

  - [ ]* 7.4 Написать property-тест для создания гильдии
    - **Property 13: Создание гильдии назначает лидера и списывает золото**
    - **Validates: Requirements 4.2**

  - [x] 7.5 Реализовать функцию joinGuild
    - Проверять, что игрок не в гильдии
    - Добавить игрока в список членов гильдии
    - Установить guildId и guildRole='member' игроку
    - _Requirements: 4.4_

  - [ ]* 7.6 Написать property-тест для доступности вступления
    - **Property 14: Доступность вступления в гильдию**
    - **Validates: Requirements 4.4**

  - [x] 7.7 Реализовать функцию applyGuildBonuses
    - Получать бонусы текущей гильдии
    - Применять процентные бонусы к наградам (опыт, золото)
    - Интегрировать в функции получения наград
    - _Requirements: 4.6_

  - [ ]* 7.8 Написать property-тест для бонусов гильдии
    - **Property 15: Применение бонусов гильдии**
    - **Validates: Requirements 4.6**

  - [x] 7.9 Реализовать повышение уровня гильдии
    - Добавлять опыт гильдии от действий членов
    - Проверять достижение maxExp
    - Увеличивать уровень гильдии
    - Улучшать бонусы гильдии
    - _Requirements: 4.7_

  - [ ]* 7.10 Написать property-тест для уровня гильдии
    - **Property 16: Повышение уровня гильдии**
    - **Validates: Requirements 4.7**

  - [x] 7.11 Интегрировать GuildScreen в навигацию
    - Обновить NavItem для раздела "Гильдии"
    - Добавить обработчик переключения на activeTab='guilds'
    - _Requirements: 4.3_

- [x] 8. Улучшения UI/UX
  - [x] 8.1 Создать систему уведомлений
    - Создать компонент NotificationSystem
    - Реализовать функцию addNotification(message, type, duration)
    - Добавить автоматическое удаление уведомлений через duration
    - Стилизовать уведомления по типам (success, info, warning, error, legendary)
    - Позиционировать в верхнем правом углу
    - _Requirements: 5.2_

  - [ ]* 8.2 Написать property-тест для уведомлений
    - **Property 17: Уведомления о важных событиях**
    - **Validates: Requirements 5.2**

  - [x] 8.3 Создать компонент Tooltip
    - Реализовать всплывающие подсказки при наведении
    - Поддерживать различные позиции (top, bottom, left, right)
    - Применить к предметам, способностям, статистике
    - _Requirements: 5.3_

  - [x] 8.4 Применить цветовое кодирование редкости
    - Создать константы RARITY_COLORS и RARITY_BG
    - Применить к предметам в инвентаре
    - Применить к рецептам крафта
    - Применить к ресурсам
    - _Requirements: 5.4_

  - [ ]* 8.5 Написать property-тест для цветового кодирования
    - **Property 18: Цветовое кодирование редкости**
    - **Validates: Requirements 5.4, 8.3**

  - [x] 8.6 Добавить анимации переходов
    - Применить animate-in fade-in zoom-in к новым экранам
    - Добавить transition-all к интерактивным элементам
    - Добавить hover:scale-105 к карточкам
    - Добавить active:scale-95 к кнопкам
    - _Requirements: 5.1_

  - [x] 8.7 Интегрировать NotificationSystem в App
    - Добавить состояние notifications
    - Рендерить NotificationSystem в корне приложения
    - Заменить все addLog на addNotification для важных событий
    - _Requirements: 5.2_

- [x] 9. Расширение контента - Локации и враги
  - [x] 9.1 Добавить новые локации
    - Создать массив NEW_LOCATIONS с 4 новыми локациями
    - Добавить поля: id, name, minLvl, enemyPower, text, resources
    - Объединить с существующими LOCATIONS
    - _Requirements: 6.1, 6.6_

  - [x] 9.2 Обновить систему разблокировки локаций
    - Фильтровать доступные локации по уровню игрока
    - Отображать требования для недоступных локаций
    - Показывать название и описание текущей локации
    - _Requirements: 6.2, 6.4, 6.5_

  - [ ]* 9.3 Написать property-тест для разблокировки локаций
    - **Property 19: Разблокировка локаций по уровню**
    - **Validates: Requirements 6.2**

  - [x] 9.4 Добавить новых врагов
    - Создать массив NEW_ENEMIES с 8 новыми врагами
    - Добавить поля: name, baseHp, baseDmg, exp, gold, icon
    - Объединить с существующими ENEMIES_DB
    - _Requirements: 7.1_

  - [x] 9.5 Обновить систему генерации врагов
    - Определить пул врагов для каждой локации
    - Масштабировать характеристики врагов по enemyPower локации
    - Добавить шанс встречи редких врагов (10% шанс, x1.5 награды)
    - _Requirements: 7.2, 7.3, 7.6_

  - [ ]* 9.6 Написать property-тест для масштабирования врагов
    - **Property 20: Масштабирование врагов по локации**
    - **Validates: Requirements 6.3, 7.3**

  - [ ]* 9.7 Написать property-тест для соответствия врагов локации
    - **Property 21: Соответствие врагов локации**
    - **Validates: Requirements 7.2**

  - [ ]* 9.8 Написать property-тест для наград врагов
    - **Property 22: Награды соответствуют сложности врага**
    - **Validates: Requirements 7.5**

- [ ] 10. Checkpoint - Проверка гильдий, UI и нового контента
  - Убедитесь, что гильдии работают, уведомления отображаются, новые локации и враги доступны. Спросите пользователя, если возникнут вопросы.


- [x] 11. Расширение контента - Новые предметы
  - [x] 11.1 Добавить новые предметы
    - Создать массив NEW_ITEMS с минимум 20 новыми предметами
    - Включить оружие, броню, расходники, ресурсы
    - Определить редкость для каждого предмета
    - Добавить уникальные эффекты для эпических и легендарных предметов
    - Объединить с существующими ITEMS_DB
    - _Requirements: 8.1, 8.2, 8.5_

  - [x] 11.2 Реализовать расчет характеристик предметов
    - Создать функцию calculateItemStats(type, rarity)
    - Определить диапазоны значений для каждой комбинации
    - Применить к генерации предметов
    - _Requirements: 8.4_

  - [ ]* 11.3 Написать property-тест для характеристик предметов
    - **Property 23: Характеристики предметов соответствуют типу и редкости**
    - **Validates: Requirements 8.4**

  - [ ]* 11.4 Написать property-тест для эффектов предметов
    - **Property 24: Эпические и легендарные предметы имеют эффекты**
    - **Validates: Requirements 8.5**

  - [x] 11.5 Обновить отображение предметов
    - Применить цветовое кодирование редкости
    - Добавить иконки для новых типов предметов
    - Показывать уникальные эффекты в описании
    - Добавить Tooltip с детальной информацией
    - _Requirements: 8.3_

  - [x] 11.6 Интегрировать новые предметы в игровые системы
    - Добавить в пул находок при путешествии
    - Добавить в магазин города
    - Добавить как результаты крафта
    - Добавить как награды за квесты
    - _Requirements: 8.6_

- [x] 12. Реализация системы достижений
  - [x] 12.1 Создать базу данных достижений (ACHIEVEMENTS)
    - Определить минимум 15 достижений
    - Добавить поля: id, name, description, category, requirement, reward, icon
    - Включить категории: exploration, combat, crafting, social, collection
    - _Requirements: 9.3, 9.6_

  - [x] 12.2 Создать компонент AchievementsScreen
    - Отображать категории достижений (вкладки)
    - Показывать список достижений с прогрессом
    - Индицировать выполненные достижения
    - Добавить кнопку получения награды
    - _Requirements: 9.3, 9.6_

  - [x] 12.3 Реализовать функцию checkAchievements
    - Проверять прогресс всех достижений
    - Сравнивать текущую статистику с требованиями
    - Разблокировать выполненные достижения
    - Показывать уведомление о разблокировке
    - _Requirements: 9.1, 9.2_

  - [ ]* 12.4 Написать property-тест для отслеживания статистики
    - **Property 25: Отслеживание статистики действий**
    - **Validates: Requirements 9.1**

  - [ ]* 12.5 Написать property-тест для разблокировки достижений
    - **Property 26: Разблокировка достижений при выполнении условий**
    - **Validates: Requirements 9.2**

  - [x] 12.6 Реализовать функцию claimAchievementReward
    - Проверять, что достижение разблокировано
    - Выдавать награды (золото, опыт, предметы)
    - Удалять из списка невостребованных
    - Показывать уведомление о получении награды
    - _Requirements: 9.4_

  - [ ]* 12.7 Написать property-тест для наград достижений
    - **Property 27: Награды за достижения**
    - **Validates: Requirements 9.4**

  - [x] 12.8 Реализовать расчет прогресса достижений
    - Создать функцию calculateAchievementProgress(achievement, player)
    - Возвращать процент выполнения
    - Отображать в UI
    - _Requirements: 9.5_

  - [ ]* 12.9 Написать property-тест для прогресса достижений
    - **Property 28: Расчет прогресса достижений**
    - **Validates: Requirements 9.5**

  - [x] 12.10 Интегрировать проверку достижений в игровые действия
    - Вызывать checkAchievements после шагов, боев, крафта, квестов
    - Обновлять счетчики статистики
    - _Requirements: 9.1, 9.2_

  - [x] 12.11 Добавить AchievementsScreen в навигацию
    - Создать новый NavItem "Достижения"
    - Добавить в NavGroup "ПЕРСОНАЖ"
    - Добавить обработчик переключения на activeTab='achievements'
    - _Requirements: 9.3_

- [x] 13. Улучшение системы сохранения
  - [x] 13.1 Обновить функцию saveGame
    - Добавить версию сохранения (version: 2)
    - Добавить timestamp
    - Сохранять все новые поля игрока
    - Обрабатывать ошибки QuotaExceededError
    - _Requirements: 10.1_

  - [ ]* 13.2 Написать property-тест для автосохранения
    - **Property 29: Автосохранение после значимых действий**
    - **Validates: Requirements 10.1**

  - [x] 13.3 Обновить функцию loadGame
    - Проверять версию сохранения
    - Выполнять миграцию старых сохранений (v1 → v2)
    - Валидировать структуру данных
    - Обрабатывать поврежденные сохранения
    - _Requirements: 10.2, 10.7_

  - [ ]* 13.4 Написать property-тест для round-trip сохранения
    - **Property 30: Round-trip сохранения и загрузки**
    - **Validates: Requirements 10.2**

  - [ ]* 13.5 Написать property-тест для обработки ошибок
    - **Property 32: Обработка поврежденных сохранений**
    - **Validates: Requirements 10.7**

  - [x] 13.6 Добавить автосохранение
    - Создать useEffect с интервалом 30 секунд
    - Сохранять при закрытии страницы (beforeunload)
    - Отображать время последнего сохранения
    - _Requirements: 10.1, 10.4_

  - [x] 13.7 Реализовать экспорт сохранения
    - Создать функцию exportSave
    - Генерировать JSON файл с сохранением
    - Скачивать файл через blob URL
    - Добавить кнопку экспорта в настройки
    - _Requirements: 10.5_

  - [x] 13.8 Реализовать импорт сохранения
    - Создать функцию importSave
    - Читать файл через FileReader
    - Валидировать версию и структуру
    - Загружать сохранение и перезагружать страницу
    - Добавить кнопку импорта в настройки
    - _Requirements: 10.6_

  - [ ]* 13.9 Написать property-тест для round-trip экспорта/импорта
    - **Property 31: Round-trip экспорта и импорта**
    - **Validates: Requirements 10.5, 10.6**

  - [x] 13.10 Создать экран настроек
    - Добавить раздел "Настройки" в навигацию
    - Отображать время последнего сохранения
    - Добавить кнопку ручного сохранения
    - Добавить кнопки экспорта/импорта
    - Добавить кнопку сброса игры
    - _Requirements: 10.3, 10.4, 10.5, 10.6_

- [x] 14. Финальная интеграция и полировка
  - [x] 14.1 Обновить начальное состояние игрока
    - Добавить все новые поля с начальными значениями
    - Обновить CharacterCreation для инициализации
    - _Requirements: 1.2, 4.2, 9.1_

  - [x] 14.2 Оптимизировать производительность
    - Мемоизировать тяжелые вычисления (useMemo)
    - Оптимизировать рендеринг списков (React.memo)
    - Проверить отсутствие утечек памяти
    - _Requirements: все_

  - [x] 14.3 Провести тестирование всех систем
    - Протестировать полный цикл профессий и крафта
    - Протестировать создание и вступление в гильдии
    - Протестировать разблокировку достижений
    - Протестировать сохранение/загрузку/экспорт/импорт
    - _Requirements: все_

  - [ ]* 14.4 Запустить все property-based тесты
    - Выполнить все 32 property-теста
    - Убедиться, что все тесты проходят
    - Исправить найденные ошибки
    - _Requirements: все_

  - [x] 14.5 Финальная полировка UI
    - Проверить консистентность стилей
    - Убедиться в корректности всех анимаций
    - Проверить адаптивность на мобильных устройствах
    - Исправить визуальные баги
    - _Requirements: 5.1, 5.2, 5.4_

- [ ] 15. Реализация группировки предметов в кузнице
  - [ ] 15.1 Создать компонент ForgeScreen с группировкой
    - Разделить предметы на две категории: оружие и броня
    - Создать секцию "Оружие" с иконкой меча
    - Создать секцию "Броня" с иконкой щита
    - Отображать сообщение, если категория пуста
    - _Requirements: 11.1, 11.2, 11.3, 11.4_

  - [ ] 15.2 Создать компонент ForgeItemCard
    - Отображать информацию о предмете (название, характеристики, уровень)
    - Применять цветовое кодирование редкости
    - Добавить кнопки "Улучшить" и "Зачаровать"
    - Показывать стоимость улучшения и зачарования
    - Отключать кнопки при недостатке золота
    - _Requirements: 11.5_

  - [ ] 15.3 Реализовать функции расчета стоимости
    - Создать calculateUpgradeCost(item)
    - Создать calculateEnchantCost(item)
    - Учитывать уровень предмета в расчетах
    - _Requirements: 11.5_

  - [ ] 15.4 Реализовать функцию handleUpgrade
    - Проверять наличие золота
    - Увеличивать уровень предмета на 1
    - Увеличивать характеристику предмета на 20%
    - Списывать золото
    - Показывать уведомление об успехе
    - _Requirements: 11.5_

  - [ ] 15.5 Реализовать функцию handleEnchant
    - Проверять наличие золота
    - Выбирать случайное зачарование
    - Применять зачарование к предмету
    - Обновлять название предмета
    - Списывать золото
    - Показывать уведомление с описанием зачарования
    - _Requirements: 11.5_

  - [ ]* 15.6 Написать property-тест для группировки предметов
    - **Property 33: Группировка предметов в кузнице по типу**
    - **Validates: Requirements 11.2, 11.3**

  - [ ] 15.7 Интегрировать ForgeScreen в навигацию
    - Обновить NavItem для раздела "Кузница"
    - Добавить обработчик переключения на activeTab='forge'
    - Убедиться в корректном отображении
    - _Requirements: 11.1_

  - [ ] 15.8 Тестирование кузницы
    - Протестировать группировку оружия и брони
    - Проверить улучшение предметов
    - Проверить зачарование предметов
    - Убедиться в корректности расчета стоимости
    - _Requirements: 11.1-11.5_

- [ ] 16. Реализация системы случайных событий
  - [x] 16.1 Создать базу данных событий (RANDOM_EVENTS)
    - Определить 4 типа событий: метеоритный дождь, нашествие монстров, торговец-путешественник, сокровищница
    - Добавить поля: id, name, description, icon, chance, duration, cooldown, action, rewards
    - _Requirements: 12.3_

  - [x] 16.2 Добавить состояние для событий
    - Создать activeEvent state для текущего события
    - Создать eventCooldowns state для отслеживания кулдаунов
    - Создать monsterWave state для счетчика волн
    - Создать merchantStock state для ассортимента торговца
    - _Requirements: 12.1_

  - [x] 16.3 Реализовать функцию triggerRandomEvent
    - Проверять отсутствие активного события
    - Фильтровать события по кулдауну
    - Проверять шанс запуска для каждого события
    - Вызывать startEvent при успехе
    - _Requirements: 12.1, 12.11_

  - [ ]* 16.4 Написать property-тест для запуска события
    - **Property 34: Запуск события при отсутствии активного**
    - **Validates: Requirements 12.1, 12.11**

  - [x] 16.5 Реализовать функцию startEvent
    - Установить activeEvent с временем начала и окончания
    - Показать уведомление о событии
    - _Requirements: 12.2_

  - [ ] 16.6 Интегрировать triggerRandomEvent в handleStep
    - Добавить вызов triggerRandomEvent в функцию handleStep
    - Проверять события при каждом шаге игрока
    - _Requirements: 12.1_

  - [ ] 16.7 Реализовать автоматическое закрытие событий
    - Создать useEffect для проверки истечения времени события
    - Проверять каждую секунду, не истекло ли время
    - Закрывать событие и устанавливать кулдаун при истечении
    - Показывать уведомление о завершении
    - _Requirements: 12.5, 12.6_

  - [ ]* 16.8 Написать property-тест для автоматического закрытия
    - **Property 36: Автоматическое закрытие события по таймеру**
    - **Validates: Requirements 12.5, 12.6**

  - [x] 16.9 Реализовать collectMeteorResources
    - Проверять активность события и тип
    - Проверять наличие энергии (5)
    - Выбирать случайный ресурс из списка
    - Добавлять ресурс в инвентарь
    - Уменьшать энергию
    - _Requirements: 12.7_

  - [ ]* 16.10 Написать property-тест для метеоритного дождя
    - **Property 37: Награды метеоритного дождя**
    - **Validates: Requirements 12.7**

  - [x] 16.11 Реализовать fightMonsterWave
    - Проверять активность события и тип
    - Проверять наличие энергии (10)
    - Создавать врага для текущей волны
    - Масштабировать характеристики врага по номеру волны
    - Увеличивать счетчик волн
    - Уменьшать энергию
    - _Requirements: 12.8_

  - [ ] 16.12 Обновить handleAttack для событий
    - Проверять, является ли текущий бой частью события
    - При победе над последней волной выдавать финальные награды
    - Закрывать событие после завершения всех волн
    - _Requirements: 12.8_

  - [ ]* 16.13 Написать property-тест для нашествия монстров
    - **Property 38: Волны нашествия монстров**
    - **Validates: Requirements 12.8**

  - [x] 16.14 Реализовать buyFromMerchant
    - Проверять активность события и тип
    - Получать предмет и рассчитывать цену со скидкой
    - Проверять наличие золота
    - Списывать золото и добавлять предмет
    - _Requirements: 12.9_

  - [x] 16.15 Реализовать buyFoodFromMerchant
    - Проверять активность события и тип
    - Получать корм и рассчитывать цену со скидкой
    - Проверять наличие золота
    - Списывать золото и добавлять корм
    - _Requirements: 12.9_

  - [ ]* 16.16 Написать property-тест для торговца
    - **Property 39: Скидки торговца-путешественника**
    - **Validates: Requirements 12.9**

  - [x] 16.17 Реализовать openTreasureVault
    - Проверять активность события и тип
    - Проверять наличие энергии (20)
    - Генерировать награды: золото, опыт, редкий предмет
    - Проверять шанс на дополнительный сундук (30%)
    - Добавлять все награды игроку
    - Уменьшать энергию
    - Закрывать событие
    - _Requirements: 12.10_

  - [ ]* 16.18 Написать property-тест для сокровищницы
    - **Property 40: Награды сокровищницы**
    - **Validates: Requirements 12.10**

  - [ ] 16.19 Создать компонент EventNotification
    - Отображать название и описание события
    - Показывать иконку события
    - Отображать таймер обратного отсчета
    - Добавить кнопки взаимодействия в зависимости от типа события
    - Показывать стоимость энергии
    - Позиционировать в верхней части экрана
    - _Requirements: 12.2, 12.4_

  - [ ]* 16.20 Написать property-тест для отображения события
    - **Property 35: Отображение информации о событии**
    - **Validates: Requirements 12.2, 12.4_

  - [ ]* 16.21 Написать property-тест для эксклюзивности событий
    - **Property 41: Эксклюзивность событий**
    - **Validates: Requirements 12.11**

  - [ ] 16.22 Интегрировать EventNotification в App
    - Рендерить EventNotification когда activeEvent !== null
    - Передать все необходимые props и обработчики
    - Убедиться в корректном позиционировании
    - _Requirements: 12.2_

  - [ ] 16.23 Тестирование системы случайных событий
    - Протестировать запуск всех 4 типов событий
    - Проверить корректность таймеров и кулдаунов
    - Убедиться в правильности наград
    - Проверить обработку недостатка энергии/золота
    - _Requirements: 12.1-12.11_

- [ ] 17. Реализация системы рыбалки
  - [x] 17.1 Создать базу данных рыб (FISH_DB)
    - Определить минимум 12 видов рыб с различной редкостью
    - Добавить поля: id, name, rarity, sellPrice, locations, icon
    - Включить рыб для всех локаций
    - _Requirements: 13.7_

  - [x] 17.2 Добавить рецепты крафта с использованием рыбы
    - Создать минимум 3 рецепта (Рыбный суп, Эликсир моря, Драконий эликсир)
    - Добавить рыбу как ингредиент в рецепты алхимика
    - _Requirements: 13.10_

  - [x] 17.3 Создать компонент FishingScreen
    - Отображать информацию о текущей локации
    - Показывать статистику рыбалки (всего поймано, самая редкая)
    - Добавить кнопку "Начать рыбалку"
    - Отображать список доступных рыб в локации
    - _Requirements: 13.1, 13.11_

  - [x] 17.4 Реализовать мини-игру рыбалки
    - Создать состояние для таймера рыбалки
    - Генерировать случайное время поклевки (5-10 секунд)
    - Отображать таймер ожидания
    - _Requirements: 13.2_

  - [x] 17.5 Реализовать механику поклевки и реакции
    - Отображать индикатор поклевки
    - Создать окно реакции (2 секунды)
    - Добавить кнопку "Поймать" во время окна реакции
    - Обрабатывать успешную и неудачную ловлю
    - _Requirements: 13.3, 13.4, 13.5_

  - [ ]* 17.6 Написать property-тест для успешной ловли
    - **Property 42: Успешная ловля рыбы при своевременной реакции**
    - **Validates: Requirements 13.4**

  - [x] 17.7 Реализовать определение пойманной рыбы
    - Фильтровать рыб по текущей локации
    - Определять редкость на основе вероятностей
    - Применять бонус от уровня игрока к шансу редкой рыбы
    - Выбирать случайную рыбу из доступных с выбранной редкостью
    - _Requirements: 13.6, 13.12_

  - [ ]* 17.8 Написать property-тест для соответствия рыбы локации
    - **Property 43: Рыба соответствует локации**
    - **Validates: Requirements 13.6**

  - [x] 17.9 Реализовать добавление рыбы в инвентарь
    - Добавлять пойманную рыбу в player.resources
    - Отображать уведомление о пойманной рыбе
    - Показывать результат ловли с анимацией
    - _Requirements: 13.8_

  - [ ]* 17.10 Написать property-тест для расхода энергии
    - **Property 45: Расход энергии при рыбалке**
    - **Validates: Requirements 13.1**

  - [x] 17.11 Реализовать продажу рыбы
    - Создать функцию sellFish(fishId)
    - Рассчитывать общую стоимость (цена * количество)
    - Удалять рыбу из ресурсов
    - Добавлять золото игроку
    - Показывать уведомление о продаже
    - _Requirements: 13.9_

  - [ ]* 17.12 Написать property-тест для стоимости рыбы
    - **Property 44: Стоимость рыбы зависит от редкости**
    - **Validates: Requirements 13.9**

  - [x] 17.13 Создать отображение инвентаря рыбы
    - Фильтровать ресурсы, являющиеся рыбой
    - Сортировать по редкости
    - Отображать количество и цену
    - Добавить кнопку "Продать все" для каждой рыбы
    - _Requirements: 13.8, 13.9_

  - [x] 17.14 Интегрировать FishingScreen в навигацию
    - Добавить NavItem для раздела "Рыбалка"
    - Добавить обработчик переключения на activeTab='fishing'
    - Убедиться в корректном отображении
    - _Requirements: 13.1_

  - [x] 17.15 Тестирование системы рыбалки
    - Протестировать мини-игру рыбалки
    - Проверить ловлю рыбы разной редкости
    - Проверить продажу рыбы
    - Убедиться в корректности статистики
    - Протестировать использование рыбы в крафте
    - _Requirements: 13.1-13.12_

- [ ] 18. Финальный checkpoint - Полное тестирование
  - Убедитесь, что все системы работают корректно, все тесты проходят, UI отполирован. Спросите пользователя для финального одобрения.

## Примечания

- Задачи, помеченные `*`, являются опциональными и могут быть пропущены для более быстрого MVP
- Каждая задача ссылается на конкретные требования для отслеживаемости
- Checkpoints обеспечивают инкрементальную валидацию
- Property-тесты должны запускаться с минимум 100 итерациями
- Все property-тесты должны ссылаться на соответствующие свойства из дизайна
